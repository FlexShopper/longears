<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to 'RabbitMQ' and the Advanced Message Queuing Protocol • longears</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interface to 'RabbitMQ' and the Advanced Message Queuing Protocol">
<meta property="og:description" content="This package provides a way to send and consume the 'AMQP'
  messages used by 'RabbitMQ' servers.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">longears</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atheriel/longears">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file. -->
<div id="longears" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#longears" class="anchor"></a>longears</h1></div>
<!-- badges: start -->

<p>This repository contains an early stage RabbitMQ client for R. It wraps the <a href="https://github.com/alanxz/rabbitmq-c">reference C library</a>.</p>
<p><a href="https://www.rabbitmq.com/">RabbitMQ</a> is a popular and performant open-source message broker used to build highly distributed and asynchronous network topologies. This package may be of interest to you if you wish to have R speak to your organization’s existing RabbitMQ servers; if you simply need a message queue library, you may be better off with <a href="https://github.com/wlandau/txtq"><strong>txtq</strong></a>, <a href="https://github.com/r-lib/liteq"><strong>litq</strong></a>, or the ZeroMQ package <a href="https://github.com/ropensci/rzmq"><strong>rzmq</strong></a>.</p>
<p>The package implements a large portion of the Advanced Message Queuing Protocol (AMQP) used by RabbitMQ , and the API largely reflects <a href="https://www.rabbitmq.com/amqp-0-9-1-reference.html">the protocol itself</a>. However, <code>longears</code> is not a true low-level package: it abstracts away many details of AMQP for end users. See <a href="#Limitations">Limitations</a> for details.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You will need <code>librabbitmq</code>, otherwise the installation will fail. On Ubuntu, run</p>
<pre class="shell"><code>$ apt install librabbitmq-dev</code></pre>
<p>The package is only available from GitHub for now, so you can install it with</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"atheriel/longears"</span>)</a></code></pre></div>
</div>
<div id="basic-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic Usage</h2>
<p>If you are not already familiar with RabbitMQ and the message/queue/binding/exchange terminology, I suggest their excellent <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html">conceptual overview</a>.</p>
<p>You will also need to have a local RabbitMQ server running with the default settings to follow this guide.</p>
<pre class="shell"><code>$ # apt install rabbitmq-server
$ systemctl start rabbitmq-server
$ rabbitmqctl status</code></pre>
<p>First, connect to the server (with the default settings):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">conn &lt;-<span class="st"> </span><span class="kw"><a href="reference/amqp_connections.html">amqp_connect</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">conn</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; AMQP Connection:</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;   status:  connected</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;   address: localhost:5672</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   vhost:   '/'</span></a></code></pre></div>
<p>Create an exchange to route messages and a couple of queues to store them:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="reference/amqp_exchanges.html">amqp_declare_exchange</a></span>(conn, <span class="st">"my.exchange"</span>, <span class="dt">type =</span> <span class="st">"fanout"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="reference/amqp_queues.html">amqp_declare_queue</a></span>(conn, <span class="st">"my.queue1"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; AMQP queue 'my.queue1'</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   messages:  0</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;   consumers: 0</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw"><a href="reference/amqp_queues.html">amqp_declare_queue</a></span>(conn, <span class="st">"my.queue2"</span>)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; AMQP queue 'my.queue2'</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;   messages:  0</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;   consumers: 0</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="reference/amqp_bindings.html">amqp_bind_queue</a></span>(conn, <span class="st">"my.queue1"</span>, <span class="st">"my.exchange"</span>, <span class="dt">routing_key =</span> <span class="st">"#"</span>)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="kw"><a href="reference/amqp_bindings.html">amqp_bind_queue</a></span>(conn, <span class="st">"my.queue2"</span>, <span class="st">"my.exchange"</span>, <span class="dt">routing_key =</span> <span class="st">"#"</span>)</a></code></pre></div>
<p>You can also set up a consumer for one of these queues with a callback:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">received &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">consumer &lt;-<span class="st"> </span><span class="kw"><a href="reference/amqp_consume.html">amqp_consume</a></span>(conn, <span class="st">"my.queue2"</span>, <span class="cf">function</span>(msg) {</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  received &lt;&lt;-<span class="st"> </span>received <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">})</a></code></pre></div>
<p>Now, send a few messages to this exchange:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="reference/amqp_publish.html">amqp_publish</a></span>(conn, <span class="st">"first"</span>, <span class="dt">exchange =</span> <span class="st">"my.exchange"</span>, <span class="dt">routing_key =</span> <span class="st">"#"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="reference/amqp_publish.html">amqp_publish</a></span>(conn, <span class="st">"second"</span>, <span class="dt">exchange =</span> <span class="st">"my.exchange"</span>, <span class="dt">routing_key =</span> <span class="st">"#"</span>)</a></code></pre></div>
<p>Check if your messages are going into the queues:</p>
<pre class="shell"><code>$ rabbitmqctl list_queues</code></pre>
<p>You can use <code><a href="reference/amqp_get.html">amqp_get()</a></code> to pull individual messages back into R:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="reference/amqp_get.html">amqp_get</a></span>(conn, <span class="st">"my.queue1"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; Delivery Tag:    1</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; Redelivered: FALSE</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; Exchange:    my.exchange</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; Routing Key: #</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; Message Count:   1</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; 66 69 72 73 74</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw"><a href="reference/amqp_get.html">amqp_get</a></span>(conn, <span class="st">"my.queue1"</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; Delivery Tag:    2</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; Redelivered: FALSE</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; Exchange:    my.exchange</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; Routing Key: #</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; Message Count:   0</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; 73 65 63 6f 6e 64</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="kw"><a href="reference/amqp_get.html">amqp_get</a></span>(conn, <span class="st">"my.queue1"</span>)</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt; character(0)</span></a></code></pre></div>
<p>Or you can use <code><a href="reference/amqp_consume.html">amqp_listen()</a></code> to run consumer callbacks:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="reference/amqp_consume.html">amqp_listen</a></span>(conn, <span class="dt">timeout =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">received</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>To clean things up, delete the queues, the exchange, and disconnect from the server.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="reference/amqp_queues.html">amqp_delete_queue</a></span>(conn, <span class="st">"my.queue1"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="reference/amqp_queues.html">amqp_delete_queue</a></span>(conn, <span class="st">"my.queue2"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw"><a href="reference/amqp_exchanges.html">amqp_delete_exchange</a></span>(conn, <span class="st">"my.exchange"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw"><a href="reference/amqp_connections.html">amqp_disconnect</a></span>(conn)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">conn</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; AMQP Connection:</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;   status:  disconnected</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;   address: localhost:5672</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;   vhost:   '/'</span></a></code></pre></div>
<p>And check that the connection is closed:</p>
<pre class="shell"><code>$ rabbitmqctl list_connections</code></pre>
</div>
<div id="limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h2>
<p>Some AMQP features are not present, notably transaction support (which there are no plans to implement). Others are not exposed through the API but are handled internally according to best practices: channels, message acknowledgements, and prefetch counts, among others. The current design goal of the package is to keep these details from the eyes of users, insofar as that is possible.</p>
<p>If you have need of an AMQP feature (or RabbitMQ extension) that is not currently available or accessible, please consider filing an issue explaining the use case you have in mind.</p>
</div>
<div id="license" class="section level2">
<h2 class="hasAnchor">
<a href="#license" class="anchor"></a>License</h2>
<p>The package is licensed under the GPL, version 2 or later.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/atheriel/longears">https://​github.com/​atheriel/​longears</a>
</li>
<li>Report a bug at <br><a href="https://github.com/atheriel/longears/issues">https://​github.com/​atheriel/​longears/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Aaron Jacobs <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>


      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/atheriel/longears"><img src="https://travis-ci.org/atheriel/longears.svg?branch=master" alt="travis-ci build status"></a></li>
<li><a href="https://cran.r-project.org/package=longears"><img src="https://www.r-pkg.org/badges/version/longears" alt="CRAN status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Aaron Jacobs.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
